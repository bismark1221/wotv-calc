<div class="row">
  <ng-select #selectBuilderUnit placeholder="Search an unit by name" class="select-builder-unit" [items]="units" groupBy="rarity" [(ngModel)]="selectedUnitId" (ngModelChange)="selectUnit()" bindLabel="name" bindValue="dataId" [editableSearchTerm]="true" dropdownPosition="bottom">
    <ng-template ng-label-tmp let-item="item">
      {{item.name}}
    </ng-template>

    <ng-template ng-optgroup-tmp let-item="item" let-index="index">
      <div class="rarityLine">
        <div class="rarityLogoAndName">
          <img src="assets/rarity/{{item.rarity}}.webp" /><span>{{ rarityTranslate[item.rarity] }}</span>
        </div>
        <div class="switchShowOnlyOtherVersion">
          Only from other version ?
          <ui-switch class="switchMainJob" (click)="toggleOtherVersion()" checkedLabel="yes" uncheckedLabel="no" [checked]="showOnlyOtherVersion === true"></ui-switch>
        </div>
      </div>
    </ng-template>

    <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
      <div class="unitLine" id="unit_{{item.dataId}}">
        <div class="unitSelector" id="unitSelector_{{item.dataId}}" [ngClass]="{'unitSelectorWithSave': savedUnits[item.dataId]}">
          <div class="unitLogo">
            <img src="assets/units/{{ item.image }}_small.webp" />
          </div>
          <div class="unitNameSelector" innerHTML="{{ item.name | highlight: search }}"></div>
        </div>
        <div class="loadDiv" *ngIf="savedUnits[item.dataId] && savedUnits[item.dataId].length > 0">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
          </svg>
        </div>
        <hr />
      </div>
    </ng-template>
  </ng-select>

  <div class="loadingBlock" *ngIf="loadingBuild">
    <h1>Your build is loading</h1>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-20 h-20 mx-auto animate-spin">
      <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
    </svg>
  </div>

  <div class="saveBlock" *ngIf="unit">
    <button class="btn btn-sub btn-buildLink" id="open_generatelink" (click)="openLinkModal(builderLink)">Get Build Link</button>
    <button class="btn btn-sub" id="open_savebuild" (click)="openSaveModal(saveModal)" *ngIf="showSave">Save</button>
  </div>

  <div class="leftBlock" *ngIf="unit">
    <table>
      <tbody>
        <tr>
          <th>{{ unit.name }}<span *ngIf="unit.customName"> - {{ unit.customName }}</span></th>
        </tr>
        <tr>
          <td>
            <div class="unitButtons">
              <button class="btn btn-sub btn-left" id="reset_unit" (click)="resetUnit()">Reset</button>
              <button class="btn btn-main btn-right" id="max_unit" (click)="maxUnit()">Max unit</button>
            </div>
            <div class="cardIcons">
              <img class="rarityImg" src="{{'assets/rarity/' + unit.rarity + '.webp'}}" />
              <img class="elementImg" src="{{'assets/elements/' + unit.element + '.webp'}}" />
            </div>
            <div>
              <img class="unitImg" src="assets/units/{{ unit.image }}_card.webp" />
            </div>
          </td>
        </tr>
        <tr>
          <th class="sub">Level</th>
        </tr>
        <tr>
          <td>
            <div class="awakeningDiv">
              <div>
                Awakening
              </div>
              <div class="stars">
                <bar-rating [(ngModel)]="star" (ngModelChange)="updateStar()" [max]="6">
                  <ng-template ratingInactive let-index="index">
                    <div class="star-inactive">&nbsp;</div>
                  </ng-template>
                  <ng-template ratingActive let-index="index">
                    <div class="star-active">&nbsp;</div>
                  </ng-template>
                </bar-rating>
              </div>
            </div>

            <div class="lbDiv">
              <div>
                Limit Break
              </div>
              <div class="lbs">
                <bar-rating [(ngModel)]="lb" (ngModelChange)="updateLB()" [max]="5">
                  <ng-template ratingInactive let-index="index">
                    <div class="lb-inactive">&nbsp;</div>
                  </ng-template>
                  <ng-template ratingActive let-index="index">
                    <div class="lb-active">&nbsp;</div>
                  </ng-template>
                </bar-rating>
              </div>
            </div>

            <div class="levelDiv">
              <div>
                Level
              </div>
              <div class="zone-select-level">
                <ng-select placeholder="Select a level" class="select-level select-left-builder" [items]="unit.tableLevels" [(ngModel)]="unit.level" (ngModelChange)="updateLevel()" [clearable]="false" [searchable]="false">
                  <ng-template ng-label-tmp let-item="item">
                    {{ item }}
                  </ng-template>

                  <ng-template ng-option-tmp let-item="item">
                    {{ item }}
                  </ng-template>
                </ng-select> / {{ unit.maxLevel }}
              </div>
            </div>

            <div class="masterSkillDiv">
              <div>
                Master Skill Level
              </div>
              <ng-select placeholder="Select a level" class="select-master-skill select-left-builder" [items]="unit.masterSkillLevel" [(ngModel)]="unit.masterSkillActivated" (ngModelChange)="updateMasterSkillLevel()" [clearable]="false" [searchable]="false">
                <ng-template ng-label-tmp let-item="item">
                  {{ item + 1}}
                </ng-template>

                <ng-template ng-option-tmp let-item="item">
                  {{ item + 1 }}
                </ng-template>
              </ng-select>
            </div>

            <div class="limitDiv" *ngIf="unit.formattedLimit">
              <div>
                Limit Level
              </div>
              <ng-select placeholder="Select a limit level" class="select-limit-level select-left-builder" [items]="[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]" (ngModelChange)="updateLimitLevel($event)" [(ngModel)]="unit.formattedLimit.level" [clearable]="false" [searchable]="false">
                <ng-template ng-label-tmp let-item="item">
                  {{ item }}
                </ng-template>

                <ng-template ng-option-tmp let-item="item">
                  {{ item }}
                </ng-template>
              </ng-select>
            </div>

            <div>
              <button class="btn btn-sub btn-left" id="reset_level" (click)="resetLevel()">Reset level</button>
              <button class="btn btn-main btn-right" id="max_level" (click)="maxLevelAndJobs()">Max level</button>
            </div>
          </td>
        </tr>
        <tr>
          <th class="sub">Jobs</th>
        </tr>
        <tr>
          <td>
            <div *ngFor="let i of [0, 1, 2]" class="jobDiv" [ngClass]="{'lastJobDiv': i === 2, 'subjobDisable': unit.jobsData[i] && !unit.jobsData[i].unlocked}">
              <div *ngIf="unit.jobsData[i]">
                <div [className]="i === 0 ? 'mainJob' : 'subJob'">
                  <img src="{{'assets/jobs/' + unit.jobsData[i].image + '_40.webp'}}" />
                </div>

                <ng-select placeholder="Select a level" class="select-job select-left-builder" [items]="unit.tableJobLevels[i]" [(ngModel)]="unit.jobsData[i].level" (ngModelChange)="updateJobLevel(i)" [clearable]="false" [disabled]="!unit.jobsData[i].unlocked">
                  <ng-template ng-label-tmp let-item="item">
                    {{ item }}
                  </ng-template>

                  <ng-template ng-option-tmp let-item="item">
                    {{ item }}
                  </ng-template>
                </ng-select>
              </div>
            </div>
            <div class="jobsButton">
              <button class="btn btn-sub btn-left" id="reset_job" (click)="resetJob()">Reset Jobs</button>
              <button class="btn btn-main btn-right" id="max_job" (click)="maxLevelAndJobs()">Max Jobs</button>
            </div>
          </td>
        </tr>
        <tr>
          <th class="sub">Sub Job</th>
        </tr>
        <tr>
          <td class="subJobColumn">
            <div *ngFor="let i of [0, 1, 2]" class="subjobDiv jobDiv" [ngClass]="{'lastJobDiv': i === 2, 'selectedSubJob': i === unit.subjob, 'subjobDisable': unit.jobsData[i] && !unit.jobsData[i].unlocked}" id="select_subjob_{{i}}" (click)="selectSubJob(i)">
              <div *ngIf="unit.jobsData[i]">
                <div class="subJob">
                  <img src="{{'assets/jobs/' + unit.jobsData[i].image + '_40.webp'}}" />
                </div>
                {{ unit.jobsData[i].name }}
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <th class="sub">Equipment</th>
        </tr>
        <tr>
          <td>
            <div class="equipmentDiv">
              Slot 1
              <div *ngIf="unit && unit.equipments && unit.equipments[0]" id="openModalEquipment0_{{unit.equipments[0].dataId}}" (click)="openEquipmentsModal(0)" class="equipmentPointer">
                <div class="background_{{ unit.equipments[0].category }}">
                  <img src="{{'assets/equipments/' + unit.equipments[0].image + '_middle.webp'}}" class="equipmentImg"/>
                </div>
              </div>
              <div *ngIf="!unit.equipments || !unit.equipments[0]" id="openModalEquipment0_new" (click)="openEquipmentsModal(0)" class="equipmentPointer">
                <img src="{{'assets/builder/no_artifact.webp'}}" class="equipmentImg"/>
              </div>
              <button class="btn btn-sub btn-equipment" id="openModalEquipment0_custom" [ngClass]="{'btn-disable': !unit.equipments || !unit.equipments[0]}" (click)="openEquipmentsModal(0)">Custom</button>
            </div>

            <div class="equipmentDiv" *ngIf="unit && unit.lb >= 2">
              Slot 2
              <div *ngIf="unit && unit.equipments && unit.equipments[1]" id="openModalEquipment1_{{unit.equipments[1].dataId}}" (click)="openEquipmentsModal(1)" class="equipmentPointer">
                <div class="background_{{ unit.equipments[1].category }}">
                  <img src="{{'assets/equipments/' + unit.equipments[1].image + '_middle.webp'}}" class="equipmentImg"/>
                </div>
              </div>
              <div *ngIf="!unit.equipments || !unit.equipments[1]" id="openModalEquipment1_new" (click)="openEquipmentsModal(1)" class="equipmentPointer">
                <img src="{{'assets/builder/no_artifact.webp'}}" class="equipmentImg"/>
              </div>
              <button class="btn btn-sub btn-equipment" [ngClass]="{'btn-disable': !unit.equipments || !unit.equipments[1]}" id="openModalEquipment1_custom" (click)="openEquipmentsModal(1)">Custom</button>
            </div>

            <div class="equipmentDiv" *ngIf="unit && (unit.lb < 2 || !unit.lb)">
              Slot 2
              <img src="{{'assets/builder/lock_artifact.webp'}}" class="equipmentImg"/>
              <button class="btn btn-sub btn-disable btn-equipment">Custom</button>
            </div>

            <div class="equipmentDiv" *ngIf="unit && unit.lb >= 4">
              TMR
              <div *ngIf="unit && unit.equipments && unit.equipments[2]" id="openModalEquipment2_{{unit.equipments[2].dataId}}" (click)="openEquipmentsModal(2)" class="equipmentPointer">
                <div class="background_{{ unit.equipments[2].category }}">
                  <img src="{{'assets/equipments/' + unit.equipments[2].image + '_middle.webp'}}" class="equipmentImg"/>
                </div>
              </div>
              <div *ngIf="!unit.equipments || !unit.equipments[2]" id="openModalEquipment2_new" (click)="openEquipmentsModal(2)" class="equipmentPointer">
                <img src="{{'assets/builder/no_artifact.webp'}}" class="equipmentImg"/>
              </div>
              <button class="btn btn-sub btn-equipment" [ngClass]="{'btn-disable': !unit.equipments || !unit.equipments[2]}" id="openModalEquipment2_custom" (click)="openEquipmentsModal(2)">Custom</button>
            </div>

            <div class="equipmentDiv" *ngIf="unit && (unit.lb < 4 || !unit.lb)">
              TMR
              <img src="{{'assets/builder/lock_artifact.webp'}}" class="equipmentImg"/>
              <button class="btn btn-sub btn-disable btn-equipment">Custom</button>
            </div>
          </td>
        </tr>
        <tr>
          <th class="sub">Esper & Card</th>
        </tr>
        <tr>
          <td>
            <div class="esparCardDiv">
              Esper
              <div *ngIf="unit.esper">
                <img src="{{'assets/espers/' + unit.esper.image + '_middle.webp'}}" class="esperImg" id="openModalEsper_{{unit.esper.dataId}}" (click)="openEspersModal()"/>
                Reso
                <ng-select placeholder="Select a level" class="select-resonance select-left-builder" [items]="[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]" [(ngModel)]="unit.esper.resonance" (ngModelChange)="updateEsperResonance()" [clearable]="false" [searchable]="false">
                  <ng-template ng-label-tmp let-item="item">
                    {{ item }}
                  </ng-template>

                  <ng-template ng-option-tmp let-item="item">
                    {{ item }}
                  </ng-template>
                </ng-select>

                <button class="btn btn-sub btn-esper" id="openModalEsper_custom_{{unit.esper.dataId}}" (click)="openEspersModal()">Custom</button>
              </div>

              <div *ngIf="!unit.esper">
                <img src="{{'assets/builder/no_esper.webp'}}" class="esperImg" id="openModalEsper_new" (click)="openEspersModal()"/>
                <button class="btn btn-sub btn-disable btn-esper" id="openModalEsper_custom_new" (click)="openEspersModal()">Custom</button>
              </div>
            </div>

            <div class="esparCardDiv">
              Main Card
              <div *ngIf="unit.card">
                <img src="{{'assets/cards/' + unit.card.image + '_middle.webp'}}" class="cardImg" id="openModalCard_{{unit.card.dataId}}" (click)="openCardsModal()"/>
                <button class="btn btn-sub btn-card" id="openModalCard_custom_{{unit.card.dataId}}" (click)="openCardsModal()">Custom</button>
              </div>

              <div *ngIf="!unit.card">
                <img src="{{'assets/builder/no_card.webp'}}" class="cardImg" id="openModalCard_new" (click)="openCardsModal()"/>
                <button class="btn btn-sub btn-disable btn-card" id="openModalCard_custom_new" (click)="openCardsModal()">Custom</button>
              </div>
            </div>

            <div class="esparCardDiv">
              Sub Card
              <div *ngIf="unit.subCard">
                <img src="{{'assets/cards/' + unit.subCard.image + '_middle.webp'}}" class="cardImg" id="openModalSubCard_{{unit.subCard.dataId}}" (click)="openCardsModal(true)"/>
                <button class="btn btn-sub btn-card" id="openModalSubCard_custom_{{unit.subCard.dataId}}" (click)="openCardsModal(true)">Custom</button>
              </div>

              <div *ngIf="!unit.subCard">
                <img src="{{'assets/builder/no_card.webp'}}" class="cardImg" id="openModalSubCard_new" (click)="openCardsModal(true)"/>
                <button class="btn btn-sub btn-disable btn-card" id="openModalSubCard_custom_new" (click)="openCardsModal(true)">Custom</button>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <th class="sub">Support Skills</th>
        </tr>
        <tr *ngFor="let i of [0, 1]">
          <td>
            <ng-select placeholder="Select a skill" class="select-support select-left-builder" [items]="unit.availableSupportNodes[i]" [(ngModel)]="unit.activatedSupport[i]" (ngModelChange)="updateSupportSkill()" [clearable]="false" [searchable]="false">
              <ng-template ng-label-tmp let-item="item">
                {{ unit.activatedSupport[i] && unit.activatedSupport[i] > 0 ? unit.board.nodes[unit.activatedSupport[i]].skill.name : "Select a skill" }}
              </ng-template>

              <ng-template ng-option-tmp let-item="item">
                {{ unit.board.nodes[item].skill.name }}
              </ng-template>
            </ng-select>
          </td>
        </tr>
        <tr>
          <th class="sub">Counter Skill</th>
        </tr>
        <tr>
          <td>
            <ng-select placeholder="Select a skill" class="select-counter select-left-builder" [items]="unit.availableCounterNodes" [(ngModel)]="unit.activatedCounter" (ngModelChange)="updateCounterSkill()" [clearable]="false" [searchable]="false">
              <ng-template ng-label-tmp let-item="item">
                {{ unit.activatedCounter && unit.activatedCounter > 0 ? unit.board.nodes[unit.activatedCounter].skill.name : "Select a skill" }}
              </ng-template>

              <ng-template ng-option-tmp let-item="item">
                {{ unit.board.nodes[item].skill.name }}
              </ng-template>
            </ng-select>
          </td>
        </tr>
        <tr>
          <th class="sub">Guild</th>
        </tr>
        <tr>
          <td>
            <div *ngFor="let statue of statueNames" class="guildDiv">
              <img class="statueImg" src="{{ 'assets/statues/' + statue + '.webp' }}"/>
              {{ unit.guild.data[statue] }}
            </div>
            <div>
              <button class="btn btn-sub btn-guild" id="showGuildDetail" (click)="showGuildDetail()">Custom</button>
            </div>
          </td>
        </tr>
        <tr>
          <th class="sub">Master Ranks</th>
        </tr>
        <tr>
          <td>
            <div *ngFor="let elementsLine of [['fire', 'ice', 'wind', 'earth'], ['lightning', 'water', 'light', 'dark']]" class="masterRanksDiv">
              <div *ngFor="let element of elementsLine" class="oneMasterRankDiv">
                <div>
                  <img class="statueImg" src="{{ 'assets/masterRanks/' + unit.masterRanks.ranks[element].ranks[(unit.masterRanks.data[element] - 1)].images.background + '_' + unit.masterRanks.ranks[element].ranks[(unit.masterRanks.data[element] - 1)].images.emblem + '_' + unit.masterRanks.ranks[element].ranks[(unit.masterRanks.data[element] - 1)].images.stars + '.webp' }}"/>
                  {{ unit.masterRanks.data[element] }}
                </div>
              </div>
            </div>
            <div>
              <button class="btn btn-sub btn-masterRanks" id="showMasterRanksDetail" (click)="showMasterRanksDetail()">Custom</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="rightBlock" *ngIf="unit">
    <table class="statsTable">
      <tbody>
        <tr>
          <th colspan="14">Stats</th>
        </tr>
        <tr>
          <th class="sub"></th>
          <th class="sub" *ngFor="let type of statsType">{{ type }}</th>
          <th class="sub">COST</th>
        </tr>
      </tbody>
      <tbody *ngIf="showStatsDetail">
        <tr *ngFor="let statFrom of statsFrom">
          <td>{{ statFrom.translate }}</td>
          <td *ngFor="let type of statsType">
            <span *ngIf="type === 'AP' && unit.stats['INITIAL_AP'][statFrom.type]">{{ unit.stats["INITIAL_AP"][statFrom.type] }} / </span>
            <span>{{ unit.stats[type][statFrom.type] }}</span>
          </td>
          <td>
            <span *ngIf="unit.calcCost && unit.calcCost[statFrom.type]">{{ unit.calcCost[statFrom.type] }}</span>
          </td>
        </tr>

        <tr *ngFor="let statFrom of [0, 1, 2]">
          <td>Equipment {{ statFrom }} Stats</td>
          <td *ngFor="let type of statsType">
            <div *ngIf="unit.stats[type].equipments">
              <span *ngIf="type === 'AP' && unit.stats['INITIAL_AP'].equipments && unit.stats['INITIAL_AP'].equipments[statFrom]">{{ unit.stats["INITIAL_AP"].equipments[statFrom] }} / </span>
              <span>{{ unit.stats[type].equipments[statFrom] }}</span>
            </div>
          </td>
          <td></td>
        </tr>

        <tr *ngFor="let statFrom of [0, 1, 2]">
          <td>Equipment {{ statFrom }} Buffs</td>
          <td *ngFor="let type of statsType">
            <span *ngIf="type === 'AP' && unit.stats['INITIAL_AP']['equipment' + statFrom + '_buff']">{{ unit.stats["INITIAL_AP"]['equipment' + statFrom + '_buff'] }} / </span>
            <span>{{ unit.stats[type]['equipment' + statFrom + '_buff'] }}</span>
          </td>
          <td></td>
        </tr>

        <tr>
          <td>Total Equipement</td>
          <td *ngFor="let type of statsType">
            <span *ngIf="type === 'AP' && unit.stats['INITIAL_AP']['totalEquipment']">{{ unit.stats["INITIAL_AP"]['totalEquipment'] }} / </span>
            <span>{{ unit.stats[type]['totalEquipment'] }}</span>
          </td>
          <td></td>
        </tr>
      </tbody>
      <tbody>
        <tr>
          <td>Total</td>
          <td *ngFor="let type of statsType">
            <span *ngIf="type === 'AP'">{{ unit.stats['INITIAL_AP'].total }} / </span>
            <span>{{ unit.stats[type].total }}</span>
          </td>
          <td>{{ unit.calcCost ? unit.calcCost.total : 0 }}</td>
        </tr>
      </tbody>
    </table>
    <button class="btn btn-sub btn-detail" (click)="showHideDetail('Stats')">Stats Detail</button>

    <table class="buffsTable">
      <tbody>
        <tr>
          <th colspan="9">Buffs</th>
        </tr>
      </tbody>
      <tbody *ngFor="let line of getAvailableStatType()">
        <tr>
          <th class="sub"></th>
          <th class="sub" *ngFor="let statType of line">
            <img *ngIf="buffsImage.indexOf(statType.toLowerCase()) !== -1" class="buffImg" title="{{ statType }}" src="{{ '/assets/buffs/' + statType.toLowerCase() + '.webp' }}">
            <span *ngIf="buffsImage.indexOf(statType.toLowerCase()) === -1">{{ statType.replace("_", " ") }}</span>
          </th>
        </tr>
        <tr [ngClass]="{'disable': !showBuffsDetail}" *ngFor="let comeFrom of buffsFrom">
          <td>{{ comeFrom.translate }}</td>
          <td *ngFor="let statType of line">{{ unit.stats[statType] ? unit.stats[statType][comeFrom.type] : '' }}</td>
        </tr>

        <tr [ngClass]="{'disable': !showBuffsDetail}" *ngFor="let statFrom of [0, 1, 2]">
          <td>Equipment {{ statFrom }} Stats</td>
          <td *ngFor="let statType of line">
            <div *ngIf="unit.stats[statType] && unit.stats[statType].equipments">
              <span>{{ unit.stats[statType].equipments[statFrom] }}</span>
            </div>
          </td>
        </tr>

        <tr [ngClass]="{'disable': !showBuffsDetail}" *ngFor="let statFrom of [0, 1, 2]">
          <td>Equipment {{ statFrom }} Buffs</td>
          <td *ngFor="let statType of line">
            <span *ngIf="unit.stats[statType]">{{ unit.stats[statType]['equipment' + statFrom + '_buff'] }}</span>
          </td>
        </tr>

        <tr  [ngClass]="{'disable': !showBuffsDetail}" >
          <td>Total Equipement</td>
          <td *ngFor="let statType of line">
            <span *ngIf="unit.stats[statType]">{{ unit.stats[statType]['totalEquipment'] }}</span>
          </td>
        </tr>

        <tr>
          <td>Total</td>
          <td *ngFor="let statType of line"><span *ngIf="unit.stats[statType]">{{ unit.stats[statType].total }}</span></td>
        </tr>
      </tbody>
    </table>
    <button class="btn btn-sub btn-detail" (click)="showHideDetail('Buffs')">Buffs Detail</button>


    <table class="imbueTable" *ngIf="unit.imbue">
      <tbody>
        <tr>
          <th colspan="9">Imbue</th>
        </tr>
        <tr>
          <td>
            <div *ngFor="let effect of unit.imbue.effectsHtml.before">
              {{ effect }}
            </div>
            <div *ngFor="let effect of unit.imbue.effectsHtml.after">
              {{ effect }}
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="skillsBlock">
      <div class="skillTitle">
        Active Skills
      </div>
      <div class="skillSubTitle" (click)="isCollapsedMainJob = !isCollapsedMainJob">
        Main Job
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="!isCollapsedMainJob">
          <path fill-rule="evenodd" d="M14.77 12.79a.75.75 0 01-1.06-.02L10 8.832 6.29 12.77a.75.75 0 11-1.08-1.04l4.25-4.5a.75.75 0 011.08 0l4.25 4.5a.75.75 0 01-.02 1.06z" clip-rule="evenodd" />
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="isCollapsedMainJob">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
        </svg>
      </div>
      <div class="collapsedSkills" *ngIf="!isCollapsedMainJob">
        <table class="skillsTable">
          <tr>
            <th class="sub skillTypeTd">Type</th>
            <th class="sub skillNameTd">Name</th>
            <th class="sub ">Effects</th>
            <th class="sub rangeTd">Range</th>
            <th class="sub skillCastTd">Casts</th>
            <th class="sub skillHitTd">Hits</th>
            <th class="sub skillCostTd">Cost</th>
          </tr>
          <tr *ngFor="let skill of getSkillsPerJob('main')" app-template-skillRow [skill]="skill" [showType]="true" [showName]="true" [showEffects]="true" [showRange]="true" [showCasts]="true" [showHits]="true" [showCost]="true"></tr>
        </table>
      </div>
      <div class="skillSubTitle" (click)="isCollapsedSubJob = !isCollapsedSubJob">
        Sub Job
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="!isCollapsedSubJob">
          <path fill-rule="evenodd" d="M14.77 12.79a.75.75 0 01-1.06-.02L10 8.832 6.29 12.77a.75.75 0 11-1.08-1.04l4.25-4.5a.75.75 0 011.08 0l4.25 4.5a.75.75 0 01-.02 1.06z" clip-rule="evenodd" />
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="isCollapsedSubJob">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
        </svg>
      </div>
      <div class="collapsedSkills" *ngIf="!isCollapsedSubJob">
        <table class="skillsTable">
          <tr>
            <th class="sub skillTypeTd">Type</th>
            <th class="sub skillNameTd">Name</th>
            <th class="sub ">Effects</th>
            <th class="sub rangeTd">Range</th>
            <th class="sub skillCastTd">Casts</th>
            <th class="sub skillHitTd">Hits</th>
            <th class="sub skillCostTd">Cost</th>
          </tr>
          <tr *ngFor="let skill of getSkillsPerJob('sub')" app-template-skillRow [skill]="skill" [showType]="true" [showName]="true" [showEffects]="true" [showRange]="true" [showCasts]="true" [showHits]="true" [showCost]="true"></tr>
        </table>
      </div>

      <div class="skillSubTitle" (click)="isCollapsedOther = !isCollapsedOther">
        Other Skills
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="!isCollapsedOther">
          <path fill-rule="evenodd" d="M14.77 12.79a.75.75 0 01-1.06-.02L10 8.832 6.29 12.77a.75.75 0 11-1.08-1.04l4.25-4.5a.75.75 0 011.08 0l4.25 4.5a.75.75 0 01-.02 1.06z" clip-rule="evenodd" />
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="isCollapsedOther">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
        </svg>
      </div>
      <div class="collapsedSkills" *ngIf="!isCollapsedOther">
        <table class="skillsTable">
          <tr>
            <th class="sub skillTypeTd">Type</th>
            <th class="sub skillNameTd">Name</th>
            <th class="sub ">Effects</th>
            <th class="sub rangeTd">Range</th>
            <th class="sub skillCastTd">Casts</th>
            <th class="sub skillHitTd">Hits</th>
            <th class="sub skillCostTd">Cost</th>
          </tr>
          <tbody *ngFor="let i of [0, 1, 2]">
            <tr *ngIf="unit.equipments[i] && unit.equipments[i].activeSkill; let skill" app-template-skillRow [skill]="skill" [showType]="true" [showName]="true" [showEffects]="true" [showRange]="true" [showCasts]="true" [showHits]="true" [showCost]="true"></tr>
          </tbody>
          <tbody *ngIf="unit.activatedSupport[0] !== '0'">
            <tr *ngFor="let skill of [unit.board.nodes[unit.activatedSupport[0]].skill]" app-template-skillRow [skill]="skill" [showType]="true" [showName]="true" [showEffects]="true" [showRange]="true" [showCasts]="true" [showHits]="true" [showCost]="true"></tr>
          </tbody>
          <tbody *ngIf="unit.activatedSupport[1] !== '0'">
            <tr *ngFor="let skill of [unit.board.nodes[unit.activatedSupport[1]].skill]" app-template-skillRow [skill]="skill" [showType]="true" [showName]="true" [showEffects]="true" [showRange]="true" [showCasts]="true" [showHits]="true" [showCost]="true"></tr>
          </tbody>
          <tbody *ngIf="unit.activatedCounter !== '0'">
            <tr *ngFor="let skill of [unit.board.nodes[unit.activatedCounter].skill]" app-template-skillRow [skill]="skill" [showType]="true" [showName]="true" [showEffects]="true" [showRange]="true" [showCasts]="true" [showHits]="true" [showCost]="true"></tr>
          </tbody>
          <tbody *ngIf="unit.formattedLimit">
            <tr app-template-skillRow [skill]="unit.formattedLimit" [showType]="true" [showName]="true" [showEffects]="true" [showRange]="true" [showCasts]="true" [showHits]="true" [showCost]="true"></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="damageSimBlock">
      <div class="damageSimTitle">
        <div class="skillSubTitle" (click)="isCollapsedDamageSim = !isCollapsedDamageSim">
          Damage Simulator
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="!isCollapsedDamageSim">
            <path fill-rule="evenodd" d="M14.77 12.79a.75.75 0 01-1.06-.02L10 8.832 6.29 12.77a.75.75 0 11-1.08-1.04l4.25-4.5a.75.75 0 011.08 0l4.25 4.5a.75.75 0 01-.02 1.06z" clip-rule="evenodd" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 inline-block chevron" *ngIf="isCollapsedDamageSim">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
      <div class="damageSimSubBlock" *ngIf="!isCollapsedDamageSim">
        <table class="tableSim">
          <tr>
            <td class="targetTd">
              <div>Unit</div>

              Active Skills
              <ng-select
                placeholder="Select a skill"
                class="select-support select-left-builder selectSimSkill"
                [items]="unit.skillsForSim"
                [clearable]="false"
                [searchable]="false"
                [(ngModel)]="damageSim.unit.selectedSkill"
                (ngModelChange)="calculateDamageSim()">

                <ng-template ng-label-tmp let-item="item">
                  {{ item.name && item.name !== "" ? item.name : "Basic Attack" }}
                </ng-template>

                <ng-template ng-option-tmp let-item="item">
                  {{ item.name && item.name !== "" ? item.name : "Basic Attack" }}
                </ng-template>
              </ng-select>

              <div>
                <div class="relative mt-1 rounded-md shadow-sm mr-3 inputUnitStatBlock inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <span class="text-gray-500 sm:text-sm">Bravery</span>
                  </div>
                  <input type="text" class="block w-full rounded-md border-gray-300 pl-16 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.brave" type="number">
                </div>

                <div class="relative mt-1 rounded-md shadow-sm inputUnitStatBlock inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <span class="text-gray-500 sm:text-sm">Faith</span>
                  </div>
                  <input type="text" class="block w-full rounded-md border-gray-300 pl-16 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.faith" type="number">
                </div>
              </div>

              <div>
                <div class="titleSim">
                  External Buffs
                </div>

                <div>
                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputMiniStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">ATK</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-16 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.atk" type="number">
                    <div class="absolute inset-y-0 right-0 flex items-center">
                      <span class="text-gray-500 sm:text-sm">%</span>
                    </div>
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputMiniStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">MAG</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-16 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.mag" type="number">
                    <div class="absolute inset-y-0 right-0 flex items-center">
                      <span class="text-gray-500 sm:text-sm">%</span>
                    </div>
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm inputMiniStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">DEX</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-16 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.dex" type="number">
                    <div class="absolute inset-y-0 right-0 flex items-center">
                      <span class="text-gray-500 sm:text-sm">%</span>
                    </div>
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputMiniStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">LUCK</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-16 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.luck" type="number">
                    <div class="absolute inset-y-0 right-0 flex items-center">
                      <span class="text-gray-500 sm:text-sm">%</span>
                    </div>
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputMiniStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">AGI</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-16 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.agi" type="number">
                    <div class="absolute inset-y-0 right-0 flex items-center">
                      <span class="text-gray-500 sm:text-sm">%</span>
                    </div>
                  </div>
                </div>

                <div>
                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Species Killer</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.raceKiller" type="number">
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Element Killer</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.elementKiller" type="number">
                  </div>
                </div>

                <div>
                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Element ATK</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.elementAtk" type="number">
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Damage Type</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.damageType" type="number">
                  </div>
                </div>

                <div>
                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">DEF Penetration</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.defense_penetration" type="number">
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">SPR Penetration</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.spirit_penetration" type="number">
                  </div>
                </div>

                <div>
                  <div class="relative mt-1 rounded-md shadow-sm inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Damage Type Penetration</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.typeResPene" type="number">
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Critical hit damage</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.buffs.critic_damage" type="number">
                  </div>
                </div>
              </div>

              <div>
                <div class="titleSim">
                  Chain
                </div>

                <div>
                  <div class="relative mt-1 rounded-md shadow-sm mr-3 inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Damage Type</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.chain.type" type="number">
                  </div>

                  <div class="relative mt-1 rounded-md shadow-sm inputUnitStatBlock inline-block">
                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                      <span class="text-gray-500 sm:text-sm">Element</span>
                    </div>
                    <input type="text" class="block w-full rounded-md border-gray-300 pl-28 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim" placeholder="0" [(ngModel)]="damageSim.unit.chain.element" type="number">
                  </div>
                </div>
              </div>
            </td>

            <td class="targetTd">
              Target

              <div>
                <ng-select placeholder="Select a target element" class="select-target-race" [items]="species" (ngModelChange)="calculateDamageSim()" [(ngModel)]="damageSim.target.race" [clearable]="false" [searchable]="false">
                  <ng-template ng-label-tmp let-item="item">
                    {{ item }}
                  </ng-template>

                  <ng-template ng-option-tmp let-item="item">
                    {{ item }}
                  </ng-template>
                </ng-select>

                <ng-select placeholder="Select a target element" class="select-target-element" [items]="['fire', 'ice', 'wind', 'earth', 'lightning', 'water', 'light', 'dark']" (ngModelChange)="calculateDamageSim()" [(ngModel)]="damageSim.target.element" [clearable]="false" [searchable]="false">
                  <ng-template ng-label-tmp let-item="item">
                    {{ item }}
                  </ng-template>

                  <ng-template ng-option-tmp let-item="item">
                    {{ item }}
                  </ng-template>
                </ng-select>
              </div>

              <div class="targetAllStats">
                <div class="titleSim">
                  Stats
                </div>

                <div class="relative mt-1 rounded-md shadow-sm mr-2 inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <span class="text-gray-500 sm:text-sm">DEF</span>
                  </div>
                  <input type="text" class="block w-24 rounded-l-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.def" type="number">
                  <div class="absolute inset-y-0 left-[105px] flex items-center">
                    <span class="text-gray-500 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /></svg></span>
                  </div>
                  <input type="text" class="block w-24 rounded-r-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.breaks.def" type="number" min="0" title="DEF break (positive)">
                </div>

                <div class="relative mt-1 rounded-md shadow-sm inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <span class="text-gray-500 sm:text-sm">SPR</span>
                  </div>
                  <input type="text" class="block w-24 rounded-l-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.spr" type="number">
                  <div class="absolute inset-y-0 left-[105px] flex items-center">
                    <span class="text-gray-500 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /></svg></span>
                  </div>
                  <input type="text" class="block w-24 rounded-r-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.breaks.spr" type="number" min="0" title="SPR break (positive)">
                </div>

                <div class="relative mt-1 rounded-md shadow-sm mr-2 inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <img class="targetStatImg" title="Element skill resistance" src="/assets/buffs/{{ damageSim.unit.selectedSkill.elem && damageSim.unit.selectedSkill.elem[0] ? damageSim.unit.selectedSkill.elem[0] : unit.element | lowercase }}_res.webp">
                  </div>
                  <input type="text" class="block w-24 rounded-l-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.elementRes" type="number">
                  <div class="absolute inset-y-0 left-[105px] flex items-center">
                    <span class="text-gray-500 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /></svg></span>
                  </div>
                  <input type="text" class="block w-24 rounded-r-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.breaks.elementRes" type="number" min="0" title="Element Resistance break (positive)">
                </div>

                <div class="relative mt-1 rounded-md shadow-sm inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <img class="targetStatImg" title="Damage type resistance" src="/assets/buffs/{{ damageSim.unit.selectedSkill.damage.type | lowercase }}_res.webp">
                  </div>
                  <input type="text" class="block w-24 rounded-l-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.damageTypeRes" type="number">
                  <div class="absolute inset-y-0 left-[105px] flex items-center">
                    <span class="text-gray-500 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /></svg></span>
                  </div>
                  <input type="text" class="block w-24 rounded-r-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.breaks.damageTypeRes" type="number" min="0" title="Damage Type Resistance Break (positive)">
                </div>

                <div class="relative mt-1 rounded-md shadow-sm mr-2 inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <img class="targetStatImg" title="Single target resistance" src="/assets/buffs/atk_res.webp">
                  </div>
                  <input type="text" class="block w-24 rounded-l-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.attack_res" type="number">
                  <div class="absolute inset-y-0 left-[105px] flex items-center">
                    <span class="text-gray-500 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /></svg></span>
                  </div>
                  <input type="text" class="block w-24 rounded-r-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.breaks.attack_res" type="number" min="0" title="Single Target Resistance break (positive)">
                </div>

                <div class="relative mt-1 rounded-md shadow-sm inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <img class="targetStatImg" title="AOE resistance" src="/assets/buffs/aoe_res.webp">
                  </div>
                  <input type="text" class="block w-24 rounded-l-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.aoe_res" type="number">
                  <div class="absolute inset-y-0 left-[105px] flex items-center">
                    <span class="text-gray-500 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /></svg></span>
                  </div>
                  <input type="text" class="block w-24 rounded-r-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.breaks.aoe_res" type="number" min="0" title="AOE Resistance Break (positive)">
                </div>

                <div class="relative mt-1 rounded-md shadow-sm mr-2 inline-block">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <span class="text-gray-500 sm:text-sm">Faith</span>
                  </div>
                  <input type="text" class="block w-24 rounded-l-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.faith" type="number">
                  <div class="absolute inset-y-0 left-[105px] flex items-center">
                    <span class="text-gray-500 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /></svg></span>
                  </div>
                  <input type="text" class="block w-24 rounded-r-lg border-gray-300 pl-14 pr-3 text-right focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm inputInSim ng-pristine ng-valid inline-block ng-touched" placeholder="0" [(ngModel)]="damageSim.target.breaks.faith" type="number" min="0" title="Faith break (positive)">
                </div>
              </div>
            </td>

            <td class="damageTd">
              <div>
                <div>Damage</div>
                <div>{{ damageSim.result.normal }}</div>

                <div>Critic</div>
                <div>{{ damageSim.result.critic }}</div>
              </div>

              <div *ngFor="let condition of damageSim.result.conditions" class="resultConditionBlock">
                <div>Max damage for condition : {{ condition.type }}</div>
                <div>{{ condition.normal }}</div>

                <div>Critic</div>
                <div>{{ condition.critic }}</div>
              </div>

              <button class="btn btn-sub" (click)="calculateDamageSim()">Calculate</button>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="treeTitle">
      Skill Tree
    </div>

    <div [className]="unit.exJobs.length > 0 ? 'builderEXUnitGridContainer' : 'builderUnitGridContainer'">
      <ul class="hexGrid" oncontextmenu="return false;">
        <li *ngFor="let node of unit.grid.gridNodes; let index;" id="node_{{node}}" (click)="clickNode(node)" (contextmenu)="rightClickNode(node)">
          <div class="hex hideNode" *ngIf="unit.grid.nodesForGrid[node].type === 'hidden'">{{ node }}</div>

          <div class="hex activated" *ngIf="unit.grid.nodesForGrid[node].type === 'center'"></div>

          <div class="hex" *ngIf="unit.grid.nodesForGrid[node].type === 'text'"
               [ngClass]="{
                 'activated': unit.board.nodes[node].activated,
                 'buff': unit.board.nodes[node].type === 'buff' && (!unit.board.nodes[node].skill.type || unit.board.nodes[node].skill.type !== 'ex_buff'),
                 'skill': unit.board.nodes[node].type === 'skill' && unit.board.nodes[node].skill.type === 'skill',
                 'support': unit.board.nodes[node].type === 'skill' && unit.board.nodes[node].skill.type === 'support',
                 'counter': unit.board.nodes[node].type === 'skill' && unit.board.nodes[node].skill.type === 'counter',
                 'ex_buff':
                   (unit.board.nodes[node].type === 'skill' && unit.board.nodes[node].skill.type === 'ex_buff') ||
                   (unit.board.nodes[node].type === 'buff' && unit.board.nodes[node].skill.type && unit.board.nodes[node].skill.type === 'ex_buff'),
                 'unit_level': unit.board.nodes[node].type === 'buff' && unit.board.nodes[node].skill.effects.length > 0 && unit.board.nodes[node].skill.effects[0].type === 'INCREASE_UNIT_LEVEL',
                 'notActivable': !canActivateNode(node)
          }" >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5" *ngIf="unit.board.nodes[node].skill.maxLevel && unit.board.nodes[node].skill.maxLevel > 1 && unit.board.nodes[node].activated">
              <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
            </svg>
            <span class="text">{{ unit.grid.nodesForGrid[node].value }}</span>
            <span class="skillLevel" *ngIf="unit.board.nodes[node].skill.maxLevel && unit.board.nodes[node].skill.maxLevel > 1 && unit.board.nodes[node].activated">lv. {{ unit.board.nodes[node].level === unit.board.nodes[node].skill.maxLevel ? 'MAX' : unit.board.nodes[node].level }}</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5" *ngIf="unit.board.nodes[node].skill.maxLevel && unit.board.nodes[node].skill.maxLevel > 1 && unit.board.nodes[node].activated" id="minus_node_{{node}}" (click)="rightClickNode(node); $event.stopPropagation()">
              <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
            </svg>
          </div>
        </li>
      </ul>

      <div [innerHTML]="unit.grid.lines | safeHtml"></div>
    </div>
  </div>
</div>
