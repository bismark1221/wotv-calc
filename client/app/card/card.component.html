<div class="row" *ngIf="card">
  <div class="leftBlock">
    <table class="cardTable">
      <tbody>
        <tr>
          <th colspan="2">{{ card.name }}</th>
        </tr>
        <tr>
          <td colspan="2"><img class="cardImg" src="{{'assets/cards/' + card.image + '_full.png'}}" /></td>
        </tr>
        <tr>
          <th class="sub">Rarity</th>
          <th class="sub">Cost</th>
        </tr>
        <tr>
          <td><img class="rarityImg" src="{{'assets/rarity/' + card.rarity + '.png'}}" /></td>
          <td>{{ card.cost }}</td>
        </tr>
        <tr>
          <td colspan="2">
            <button class="btn btn-sub" [routerLink]="[getRoute('/builder/card/' + card.slug)]">Go To Builder</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="rightBlock">
    <table class="statTable">
      <tbody>
        <tr>
          <th colspan="10">Stats</th>
        </tr>
        <tr>
          <th class="sub"></th>
          <th class="sub" *ngFor="let stat of card.statsType">{{ stat }}</th>
        </tr>
        <tr>
          <td>Min</td>
          <td *ngFor="let stat of card.statsType">{{ card.stats[stat].min }}</td>
        </tr>
        <tr>
          <td>Max</td>
          <td *ngFor="let stat of card.statsType">{{ card.stats[stat].max }}</td>
        </tr>
      </tbody>
    </table>

    <table class="effectsTable">
      <tr>
        <th class="sub" colspan="10">Unit Effects</th>
      </tr>
      <tbody *ngFor="let buff of card.unitBuffs">
        <tr *ngFor="let cond of buff.cond">
          <td>Condition</td>
          <td colspan="10">
            <div *ngIf="cond.type == 'birth'">
              <span *ngFor="let birth of cond.items">{{ birth }}</span>
            </div>

            <div *ngIf="cond.type == 'elem'">
              <img class="elementImg" src="{{'assets/elements/' + elem + '.png'}}" *ngFor="let elem of cond.items"/>
            </div>

            <div *ngIf="cond.type == 'job'">
              <img *ngFor="let job of cond.items" class="subJob" src="{{'assets/jobs/' + job.image + '.png'}}" />
            </div>

            <div *ngIf="cond.type == 'unit'">
              <img *ngFor="let unit of cond.items" class="unit" src="{{'assets/units/' + unit.image + '_m.png'}}" />
            </div>
          </td>
        </tr>
        <tr *ngIf="buff.classic && buff.classic.type == 'support'">
          <td>Classic</td>
          <td colspan="10">
            <div *ngFor="let effect of buff.classic.effects">
              {{ effect.formatHtml }}
            </div>
          </td>
        </tr>
        <tr *ngIf="buff.awake && buff.classic.type == 'support'">
          <td>Awake</td>
          <td colspan="10">
            <div *ngFor="let effect of buff.awake.effects">
              {{ effect.formatHtml }}
            </div>
          </td>
        </tr>
        <tr *ngIf="buff.lvmax && buff.classic.type == 'support'">
          <td>Max</td>
          <td colspan="10">
            <div *ngFor="let effect of buff.lvmax.effects">
              {{ effect.formatHtml }}
            </div>
          </td>
        </tr>
        <tr *ngIf="buff.classic && buff.classic.type != 'support'">
          <th class="sub">name</th>
          <th class="sub">Effects</th>
          <th class="sub">Range</th>
          <th class="sub">Casts</th>
          <th class="sub">Hits</th>
          <th class="sub">Cost</th>
        </tr>
        <tr *ngIf="buff.classic && buff.classic.type != 'support'">
          <td class="skillNameTd">
            <span>{{ buff.classic.name }}</span>
            <span *ngIf="buff.classic.based"><img class='atkBasedImg' src="{{'assets/atkBased/' + buff.classic.based + '.png'}}" /></span>
            <div *ngIf="buff.classic.time && buff.classic.time.minValue">
              <ng-template #tip_time>
                <div>
                  Min time: {{ buff.classic.time.minValue }}<br />
                  Max time: {{ buff.classic.time.maxValue }}
                </div>
              </ng-template>
              <img class='timeImg' src="{{'assets/icons/time.png'}}" [ngbTooltip]="tip_time"/>
            </div>
          </td>
          <td class="skillEffectTd">
            <div>{{ buff.classic.counterHtml }}</div>
            <div [innerHTML]="buff.classic.damageHtml"></div>
            <div *ngFor="let effect of buff.classic.effects">
              {{ effect.formatHtml }}
            </div>
          </td>
          <td class="rangeTd">
            <ng-template #tip_table><div [innerHTML]="buff.classic.skillTableHtml"></div></ng-template>
            <div [ngbTooltip]="tip_table" triggers="click" [autoClose]="true">
              <div class="divSkillTableHtml" [innerHTML]="buff.classic.skillTableHtml"></div>
            </div>
          </td>
          <td class="skillCastTd">
            {{ buff.classic.count }}
          </td>
          <td class="skillHitTd">
            <span *ngIf="buff.classic.combo">{{ buff.classic.combo.num }}</span>
          </td>
          <td class="skillCostTd">
            <span *ngIf="buff.classic.cost">{{ buff.classic.cost.value }} {{ buff.classic.cost.type }}</span>
          </td>
        </tr>
        <tr class="separatorLine"></tr>
      </tbody>
    </table>

    <table class="effectsTable">
      <tbody>
        <tr>
          <th class="sub" colspan="10">Party Effects</th>
        </tr>
        <tr *ngIf="card.partyBuffs.classic">
          <td>Classic</td>
          <td colspan="10">
            <div *ngFor="let effect of card.partyBuffs.classic.effects">
              {{ effect.formatHtml }}
            </div>
          </td>
        </tr>
        <tr *ngIf="card.partyBuffs.awake">
          <td>Awake</td>
          <td colspan="10">
            <div *ngFor="let effect of card.partyBuffs.awake.effects">
              {{ effect.formatHtml }}
            </div>
          </td>
        </tr>
        <tr *ngIf="card.partyBuffs.lvmax">
          <td>Max</td>
          <td colspan="20">
            <div *ngFor="let effect of card.partyBuffs.lvmax.effects">
              {{ effect.formatHtml }}
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
