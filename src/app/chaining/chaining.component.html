<div class="row chainParameters" *ngFor="let i of [0,1]">
  <div class="row form-group unit" *ngIf="i === 0 || chain[i - 1]">
    <div class="selectLeftZone">
      <div *ngIf="!chain[i] || chain[i].id">
        <label for="chain{{i}}">Unit {{ i + 1 }}</label>
        <select class="form-control" id="chain{{i}}" [(ngModel)]="selectedUnits[i]" (ngModelChange)="onChangeUnit(i)">
          <option selected>Select unit</option>
          <option *ngFor="let unit of units | type:'chain'" [ngValue]="unit">{{unit.name}}</option>
        </select>
        <img src='assets/units/{{ chain[i].id }}.png' *ngIf="chain[i]" />
      </div>
      <div *ngIf="!chain[i]">
        <button class="btn btn-secondary fullWidth littleMarginTop" type="button" (click)="createNewUnit(i)">Create New Unit</button>
      </div>
      <div *ngIf="chain[i - 1] && !chain[i]">
        <button class="btn btn-secondary fullWidth littleMarginTop" type="button" (click)="duplicateUnit()">Duplicate Unit 1</button>
      </div>
      <div *ngIf="chain[i] && !chain[i].id">
        <label for="chainer{{i}}_name">Unit name {{ i + 1 }}</label>
        <input class="form-control" type="text" id="chainer{{i}}_name" [(ngModel)]="chain[i].name" (ngModelChange)="onChangeChain()">
      </div>
    </div>

    <div class="selectRightZone" *ngIf="chain[i]">
      <div class="selectRightZoneBox">
        <div class="selectRightZoneOneThird">
          <label for="chainer{{i}}_dual">Dualcast/Dualwield</label>
          <select class="form-control" id="chainer{{i}}_dual" [(ngModel)]="chain[i].dual" (ngModelChange)="onChangeDual(i)">
            <option [ngValue]="true">Yes</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>

        <div class="selectRightZoneOneThird">
          <label for="chainer{{i}}_weapon1">Element weapon 1</label>
          <select class="form-control" id="chainer{{i}}_weapon1" [(ngModel)]="chain[i].weapons[0]" (ngModelChange)="onChangeChain()">
            <option *ngFor="let element of elements" [ngValue]="element">{{element}}</option>
          </select>
        </div>

        <div class="selectRightZoneOneThird" *ngIf="chain[i].dual">
          <label for="chainer{{i}}_weapon2">Element weapon 2</label>
          <select class="form-control" id="chainer{{i}}_weapon2" [(ngModel)]="chain[i].weapons[1]" (ngModelChange)="onChangeChain()">
            <option *ngFor="let element of elements" [ngValue]="element">{{element}}</option>
          </select>
        </div>
      </div>

      <div class="selectRightZoneBox littleMarginTop">
        <div class="selectRightZoneOneThird" *ngIf="chain[i].id">
          <label for="chainer{{i}}_ability">Ability</label>
          <select class="form-control" id="chainer{{i}}_ability" [(ngModel)]="selectedAbilities[i]" (ngModelChange)="onChangeSkill(i)">
            <option *ngFor="let ability of chain[i].abilities; let j = index" [ngValue]="j">{{ability.name}}</option>
          </select>
        </div>

        <div class="selectRightZoneOneThird" *ngIf="!chain[i].id">
          <label for="chainer{{i}}_ability">Ability name</label>
          <input class="form-control" type="text" id="chainer{{i}}_ability" [(ngModel)]="chain[i].ability.name" (ngModelChange)="onChangeChain()">
        </div>

        <div class="selectRightZoneOneThird">
          <label for="chainer{{i}}_base">Base %</label>
          <input class="form-control" type="number" id="chainer{{i}}_base" [(ngModel)]="chain[i].ability.base" (ngModelChange)="onChangeChain()">
        </div>

        <div class="selectRightZoneOneThird">
          <label for="chainer{{i}}_ignore">Ignore (Def/Spr)</label>
          <input class="form-control" type="number" id="chainer{{i}}_ignore" [(ngModel)]="chain[i].ability.ignore" (ngModelChange)="onChangeChain()">
        </div>
      </div>

      <div class="selectRightZoneBox littleMarginTop">
        <div class="selectRightZoneOneThird">
          <label for="chainer{{i}}_hit">Hits</label>
          <input class="form-control" type="number" id="chainer{{i}}_hits" [(ngModel)]="chain[i].ability.hits" (ngModelChange)="onChangeChain()">
        </div>

        <div class="selectRightZoneOneThird">
          <label for="chainer{{i}}_frames">Frames</label>
          <input class="form-control" type="number" id="chainer{{i}}_linearFrames" [(ngModel)]="chain[i].ability.linearFrames" (ngModelChange)="onChangeChain()">
        </div>

        <div class="selectRightZoneOneThird">
          <label for="chainer{{i}}_type">Type</label>
          <select class="form-control" id="chainer{{i}}_type" [(ngModel)]="chain[i].ability.type" (ngModelChange)="onChangeChain()">
            <option *ngFor="let abilityType of abilityTypes" [ngValue]="abilityType">{{abilityType}}</option>
          </select>
        </div>
      </div>

      <div class="selectRightZoneBox littleMarginTop">
        <button class="btn btn-secondary btnAddDebuff" type="button" (click)="addElement(i)">Add element</button>
        <div *ngFor="let abilityElement of chain[i].elements; let j = index" class="selectRightZoneBox littleMarginTop">
          <div class="selectRightZoneOneThird">
            <label for="unit{{i}}_element{{j}}">Element {{j + 1}}</label>
            <select class="form-control" id="unit{{i}}_element{{j}}" [(ngModel)]="chain[i].elements[j].type" (ngModelChange)="onChangeElement(i)">
              <option *ngFor="let element of requiredElements" [ngValue]="element">{{element}}</option>
            </select>
          </div>

          <div class="selectRightZoneOneThird">
            <button class="btn btn-secondary fullWidth" type="button" (click)="removeElement(i, j)">Remove element</button>
          </div>
        </div>
      </div>

      <div class="selectRightZoneBox littleMarginTop">
        <button class="btn btn-secondary btnAddDebuff" type="button" (click)="addDebuff(i)">Add debuff</button>
        <div *ngFor="let debuff of chain[i].debuffs; let j = index" class="selectRightZoneBox littleMarginTop">
          <div class="selectRightZoneOneThird">
            <label for="unit{{i}}_debuff{{j}}_type">Debuff element {{j + 1}}</label>
            <select class="form-control" id="unit{{i}}_debuff{{j}}_type" [(ngModel)]="chain[i].debuffs[j].type" (ngModelChange)="onChangeDebuff(i)">
              <option *ngFor="let element of requiredElements" [ngValue]="element">{{element}}</option>
            </select>
          </div>
          <div class="selectRightZoneOneThird">
            <label for="unit{{i}}_debuff{{j}}_value">Debuff value {{j + 1}}</label>
            <input class="form-control" type="number" id="unit{{i}}_debuff{{j}}_value" [(ngModel)]="chain[i].debuffs[j].value" (ngModelChange)="onChangeDebuff(i, j)">
          </div>
          <div class="selectRightZoneOneThird">
            <button class="btn btn-secondary fullWidth" type="button" (click)="removeDebuff(i, j)">Remove debuff</button>
          </div>
        </div>
      </div>
    </div>

    <div class="selectDeleteZone" *ngIf="chain[i]">
      <button class="btn btn-secondary fullWidth btnDelete" type="button" (click)="deleteUnit(i)">X</button>
    </div>
  </div>
</div>

<div class="row" *ngIf="chain[1]">
  <label for="framesGap">Spark ?</label>
  <select class="form-control" id="framesGap" [(ngModel)]="framesGap" (ngModelChange)="onChangeChain()">
    <option value="0">Oui</option>
    <option value="1">Non</option>
  </select>
</div>

<div class="row littleMarginTop" *ngIf="chain[0]">
  <h2>Total Modifier : {{chainService.getResult()}}%</h2>
</div>

<app-chain-chart *ngIf="chain[0]"></app-chain-chart>
