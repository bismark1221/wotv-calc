{"version":3,"file":"ngx-md.umd.js","sources":["ng://ngx-md/lib/ngx-md.service.ts","ng://ngx-md/lib/ngx-md.component.ts","ng://ngx-md/lib/ngx-md.config.ts","ng://ngx-md/lib/ngx-md.module.ts"],"sourcesContent":["import { Injectable, SecurityContext } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { throwError, Observable } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Renderer, setOptions, parse } from 'marked';\nimport { DomSanitizer } from '@angular/platform-browser';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class NgxMdService {\n  private _renderer: any = new Renderer();\n  constructor(private _http: HttpClient, private _domSanitizer: DomSanitizer) {\n    this.extendRenderer();\n    this.setMarkedOptions({});\n  }\n\n  // get the content from remote resource\n  getContent(path: string): Observable<any> {\n    return this._http.get(path, { responseType: 'text' }).pipe(\n      map(res => this.extractData(res)),\n      catchError(this.handleError)\n    );\n  }\n\n  public get renderer(): Renderer {\n    return this._renderer;\n  }\n\n  // handle data\n  public extractData(res: any): string {\n    return res || '';\n  }\n\n  public setMarkedOptions(options: any) {\n    options = Object.assign(\n      {\n        gfm: true,\n        tables: true,\n        breaks: false,\n        pedantic: false,\n        sanitize: false,\n        smartLists: true,\n        smartypants: false,\n      },\n      options\n    );\n    options.renderer = this._renderer;\n    setOptions(options);\n  }\n\n  // comple markdown to html\n  public compile(data: string, sanitize = true) {\n    return this._domSanitizer.sanitize(\n      sanitize ? SecurityContext.HTML : SecurityContext.NONE,\n      parse(data).trim()\n    );\n  }\n\n  // handle error\n  private handleError(error: HttpErrorResponse): any {\n    const errMsg = error.message ? error.message : error.toString();\n    return throwError(errMsg);\n  }\n\n  // extend marked render to support todo checkbox\n  private extendRenderer() {\n    this._renderer.listitem = function(text: string) {\n      if (/^\\s*\\[[x ]\\]\\s*/.test(text)) {\n        text = text\n          .replace(\n            /^\\s*\\[ \\]\\s*/,\n            '<input type=\"checkbox\" class=\"md-checkbox\" disabled> '\n          )\n          .replace(\n            /^\\s*\\[x\\]\\s*/,\n            '<input type=\"checkbox\" class=\"md-checkbox\" checked disabled> '\n          );\n        return '<li style=\"list-style: none\">' + text + '</li>';\n      } else {\n        return '<li>' + text + '</li>';\n      }\n    };\n  }\n}\n","import {\n  Component,\n  ElementRef,\n  AfterViewInit,\n  Input,\n  PLATFORM_ID,\n  Inject,\n  Output,\n  EventEmitter,\n} from '@angular/core';\nimport { NgxMdService } from './ngx-md.service';\nimport { isPlatformBrowser } from '@angular/common';\nimport * as Prism from 'prismjs';\nimport { Subscribable } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\n@Component({\n  selector: 'markdown,[Markdown],ngx-md,[NgxMd]',\n  template: '<ng-content></ng-content>',\n  styles: [\n    `\n      .token.operator,\n      .token.entity,\n      .token.url,\n      .language-css .token.string,\n      .style .token.string {\n        background: none;\n      }\n      .md-checkbox {\n        vertical-align: middle;\n        margin: 0 0.2em 0.25em -1.6em;\n        font-size: 16px;\n      }\n    `,\n  ],\n})\nexport class NgxMdComponent implements AfterViewInit {\n  _path: string;\n  _data: string;\n  _md: any;\n  _ext: string;\n  changeLog: string[] = [];\n  @Output() error: EventEmitter<any> = new EventEmitter<any>();\n  @Output() loaded: EventEmitter<any> = new EventEmitter<any>();\n\n  constructor(\n    public _mdService: NgxMdService,\n    public _el: ElementRef,\n    @Inject(PLATFORM_ID) public platformId: string\n  ) {}\n\n  @Input()\n  set path(value: string) {\n    if (value) {\n      this._path = value;\n      this.onPathChange();\n    }\n  }\n\n  @Input()\n  set data(value: string) {\n    if (value) {\n      this._data = value;\n      this.onDataChange(value);\n    }\n  }\n\n  /**\n   * Boolean indicating if the markdown content should be sanitized to avoid script injections\n   */\n  @Input() public sanitizeHtml = true;\n\n  // on input\n  onDataChange(data: string) {\n    if (data) {\n      this._el.nativeElement.innerHTML = this._mdService.compile(\n        data,\n        this.sanitizeHtml\n      );\n    } else {\n      this._el.nativeElement.innerHTML = '';\n    }\n    this.highlightContent(false);\n  }\n\n  /**\n   *  After view init\n   */\n  ngAfterViewInit() {\n    if (this._path) {\n      this.onPathChange();\n    } else if (!this._data) {\n      this.processRaw();\n    }\n  }\n\n  processRaw() {\n    this._md = this.prepare(decodeHtml(this._el.nativeElement.innerHTML));\n    this._el.nativeElement.innerHTML = this._mdService.compile(\n      this._md,\n      this.sanitizeHtml\n    );\n    this.highlightContent(false);\n  }\n\n  /**\n   * get remote conent;\n   */\n  onPathChange() {\n    this._ext =\n      this._path &&\n      this._path\n        .split('.')\n        .splice(-1)\n        .join();\n    this._mdService\n      .getContent(this._path)\n      .pipe(catchError(this.handleError))\n      .subscribe(data => {\n        this.loaded.emit(data);\n        this._md =\n          this._ext !== 'md' ? '```' + this._ext + '\\n' + data + '\\n```' : data;\n        this._el.nativeElement.innerHTML = this._mdService.compile(\n          this.prepare(this._md),\n          this.sanitizeHtml\n        );\n        this.highlightContent(false);\n      });\n  }\n\n  /**\n   * catch http error\n   */\n  private handleError(error: any): Subscribable<any> {\n    this.error.emit(error);\n    console.error('An error occurred', error); // for demo purposes only\n    return error.message || error;\n  }\n\n  /**\n   * Prepare string\n   */\n  prepare(raw: string) {\n    if (!raw) {\n      return '';\n    }\n    if (this._ext === 'md' || !this.path) {\n      let isCodeBlock = false;\n      return raw\n        .split('\\n')\n        .map((line: string) => {\n          // If the first non-blank chars are an opening/closing code block, toggle the flag\n          if (this.trimLeft(line).substring(0, 3) === '```') {\n            isCodeBlock = !isCodeBlock;\n          }\n          return isCodeBlock ? line : line.trim();\n        })\n        .join('\\n');\n    }\n    return raw.replace(/\\\"/g, '\\'');\n  }\n\n  /**\n   * Trim left whitespace\n   */\n  private trimLeft(line: string) {\n    return line.replace(/^\\s+|\\s+$/g, '');\n  }\n\n  /**\n   * Use Prism to highlight code snippets only on the browser\n   */\n  private highlightContent(async: boolean): void {\n    if (isPlatformBrowser(this.platformId)) {\n      Prism.highlightAll(async);\n    }\n  }\n}\n\nfunction decodeHtml(html: string) {\n  // https://stackoverflow.com/a/7394787/588521\n  const txt = document.createElement('textarea');\n  txt.innerHTML = html;\n  return txt.value;\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class NgxMdConfig {\n  /** config modue */\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { NgxMdService } from './ngx-md.service';\nimport { NgxMdConfig } from './ngx-md.config';\nimport { NgxMdComponent } from './ngx-md.component';\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: [NgxMdComponent],\n  providers: [NgxMdService],\n  exports: [NgxMdComponent],\n})\nexport class NgxMdModule {\n  public static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: NgxMdModule,\n      providers: [NgxMdConfig],\n    };\n  }\n}\n"],"names":["Renderer","map","catchError","setOptions","SecurityContext","parse","throwError","Injectable","HttpClient","DomSanitizer","EventEmitter","isPlatformBrowser","Prism.highlightAll","Component","ElementRef","Inject","PLATFORM_ID","Output","Input","NgModule","CommonModule"],"mappings":";;;;;;;;;;;AAAA;QAYE,sBAAoB,KAAiB,EAAU,aAA2B;YAAtD,UAAK,GAAL,KAAK,CAAY;YAAU,kBAAa,GAAb,aAAa,CAAc;YADlE,cAAS,GAAQ,IAAIA,eAAQ,EAAE,CAAC;YAEtC,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC;SAC3B;;;;;;;QAGD,iCAAU;;;;;;QAAV,UAAW,IAAY;YAAvB,iBAKC;YAJC,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,YAAY,EAAE,MAAM,EAAE,CAAC,CAAC,IAAI,CACxDC,aAAG;;;;YAAC,UAAA,GAAG,IAAI,OAAA,KAAI,CAAC,WAAW,CAAC,GAAG,CAAC,GAAA,EAAC,EACjCC,oBAAU,CAAC,IAAI,CAAC,WAAW,CAAC,CAC7B,CAAC;SACH;QAED,sBAAW,kCAAQ;;;;YAAnB;gBACE,OAAO,IAAI,CAAC,SAAS,CAAC;aACvB;;;WAAA;;;;;;;QAGM,kCAAW;;;;;;QAAlB,UAAmB,GAAQ;YACzB,OAAO,GAAG,IAAI,EAAE,CAAC;SAClB;;;;;QAEM,uCAAgB;;;;QAAvB,UAAwB,OAAY;YAClC,OAAO,GAAG,MAAM,CAAC,MAAM,CACrB;gBACE,GAAG,EAAE,IAAI;gBACT,MAAM,EAAE,IAAI;gBACZ,MAAM,EAAE,KAAK;gBACb,QAAQ,EAAE,KAAK;gBACf,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,IAAI;gBAChB,WAAW,EAAE,KAAK;aACnB,EACD,OAAO,CACR,CAAC;YACF,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;YAClCC,iBAAU,CAAC,OAAO,CAAC,CAAC;SACrB;;;;;;;;QAGM,8BAAO;;;;;;;QAAd,UAAe,IAAY,EAAE,QAAe;YAAf,yBAAA,EAAA,eAAe;YAC1C,OAAO,IAAI,CAAC,aAAa,CAAC,QAAQ,CAChC,QAAQ,GAAGC,oBAAe,CAAC,IAAI,GAAGA,oBAAe,CAAC,IAAI,EACtDC,YAAK,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CACnB,CAAC;SACH;;;;;;;;QAGO,kCAAW;;;;;;;QAAnB,UAAoB,KAAwB;;gBACpC,MAAM,GAAG,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,QAAQ,EAAE;YAC/D,OAAOC,eAAU,CAAC,MAAM,CAAC,CAAC;SAC3B;;;;;;;QAGO,qCAAc;;;;;;QAAtB;YACE,IAAI,CAAC,SAAS,CAAC,QAAQ;;;;YAAG,UAAS,IAAY;gBAC7C,IAAI,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;oBAChC,IAAI,GAAG,IAAI;yBACR,OAAO,CACN,cAAc,EACd,uDAAuD,CACxD;yBACA,OAAO,CACN,cAAc,EACd,+DAA+D,CAChE,CAAC;oBACJ,OAAO,+BAA+B,GAAG,IAAI,GAAG,OAAO,CAAC;iBACzD;qBAAM;oBACL,OAAO,MAAM,GAAG,IAAI,GAAG,OAAO,CAAC;iBAChC;aACF,CAAA,CAAC;SACH;;oBA5EFC,eAAU,SAAC;wBACV,UAAU,EAAE,MAAM;qBACnB;;;;oBARQC,eAAU;oBAIVC,4BAAY;;;2BALrB;KAOA,IA6EC;;;;;;QAzEC,iCAAwC;;;;;QAC5B,6BAAyB;;;;;QAAE,qCAAmC;;;;;;;;ACZ5E;QA6CE,wBACS,UAAwB,EACxB,GAAe,EACM,UAAkB;YAFvC,eAAU,GAAV,UAAU,CAAc;YACxB,QAAG,GAAH,GAAG,CAAY;YACM,eAAU,GAAV,UAAU,CAAQ;YAPhD,cAAS,GAAa,EAAE,CAAC;YACf,UAAK,GAAsB,IAAIC,iBAAY,EAAO,CAAC;YACnD,WAAM,GAAsB,IAAIA,iBAAY,EAAO,CAAC;;;;YA2B9C,iBAAY,GAAG,IAAI,CAAC;SArBhC;QAEJ,sBACI,gCAAI;;;;;YADR,UACS,KAAa;gBACpB,IAAI,KAAK,EAAE;oBACT,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;oBACnB,IAAI,CAAC,YAAY,EAAE,CAAC;iBACrB;aACF;;;WAAA;QAED,sBACI,gCAAI;;;;;YADR,UACS,KAAa;gBACpB,IAAI,KAAK,EAAE;oBACT,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;oBACnB,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;iBAC1B;aACF;;;WAAA;;;;;;;QAQD,qCAAY;;;;;;QAAZ,UAAa,IAAY;YACvB,IAAI,IAAI,EAAE;gBACR,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CACxD,IAAI,EACJ,IAAI,CAAC,YAAY,CAClB,CAAC;aACH;iBAAM;gBACL,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,SAAS,GAAG,EAAE,CAAC;aACvC;YACD,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;SAC9B;;;;;;;;QAKD,wCAAe;;;;QAAf;YACE,IAAI,IAAI,CAAC,KAAK,EAAE;gBACd,IAAI,CAAC,YAAY,EAAE,CAAC;aACrB;iBAAM,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;gBACtB,IAAI,CAAC,UAAU,EAAE,CAAC;aACnB;SACF;;;;QAED,mCAAU;;;QAAV;YACE,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC,CAAC;YACtE,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CACxD,IAAI,CAAC,GAAG,EACR,IAAI,CAAC,YAAY,CAClB,CAAC;YACF,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;SAC9B;;;;;;;;QAKD,qCAAY;;;;QAAZ;YAAA,iBAoBC;YAnBC,IAAI,CAAC,IAAI;gBACP,IAAI,CAAC,KAAK;oBACV,IAAI,CAAC,KAAK;yBACP,KAAK,CAAC,GAAG,CAAC;yBACV,MAAM,CAAC,CAAC,CAAC,CAAC;yBACV,IAAI,EAAE,CAAC;YACZ,IAAI,CAAC,UAAU;iBACZ,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC;iBACtB,IAAI,CAACR,oBAAU,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;iBAClC,SAAS;;;;YAAC,UAAA,IAAI;gBACb,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACvB,KAAI,CAAC,GAAG;oBACN,KAAI,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,GAAG,KAAI,CAAC,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,OAAO,GAAG,IAAI,CAAC;gBACxE,KAAI,CAAC,GAAG,CAAC,aAAa,CAAC,SAAS,GAAG,KAAI,CAAC,UAAU,CAAC,OAAO,CACxD,KAAI,CAAC,OAAO,CAAC,KAAI,CAAC,GAAG,CAAC,EACtB,KAAI,CAAC,YAAY,CAClB,CAAC;gBACF,KAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;aAC9B,EAAC,CAAC;SACN;;;;;;;;;;QAKO,oCAAW;;;;;;QAAnB,UAAoB,KAAU;YAC5B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACvB,OAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC;YAC1C,OAAO,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC;SAC/B;;;;;;;;;QAKD,gCAAO;;;;;QAAP,UAAQ,GAAW;YAAnB,iBAkBC;YAjBC,IAAI,CAAC,GAAG,EAAE;gBACR,OAAO,EAAE,CAAC;aACX;YACD,IAAI,IAAI,CAAC,IAAI,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;;oBAChC,aAAW,GAAG,KAAK;gBACvB,OAAO,GAAG;qBACP,KAAK,CAAC,IAAI,CAAC;qBACX,GAAG;;;;gBAAC,UAAC,IAAY;;oBAEhB,IAAI,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,EAAE;wBACjD,aAAW,GAAG,CAAC,aAAW,CAAC;qBAC5B;oBACD,OAAO,aAAW,GAAG,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;iBACzC,EAAC;qBACD,IAAI,CAAC,IAAI,CAAC,CAAC;aACf;YACD,OAAO,GAAG,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;SACjC;;;;;;;;;;QAKO,iCAAQ;;;;;;QAAhB,UAAiB,IAAY;YAC3B,OAAO,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;SACvC;;;;;;;;;;QAKO,yCAAgB;;;;;;QAAxB,UAAyB,KAAc;YACrC,IAAIS,wBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE;gBACtCC,oBAAkB,CAAC,KAAK,CAAC,CAAC;aAC3B;SACF;;oBAhKFC,cAAS,SAAC;wBACT,QAAQ,EAAE,oCAAoC;wBAC9C,QAAQ,EAAE,2BAA2B;iCAEnC,iTAaC;qBAEJ;;;;oBAzBQ,YAAY;oBARnBC,eAAU;iDA8CPC,WAAM,SAACC,gBAAW;;;4BANpBC,WAAM;6BACNA,WAAM;2BAQNC,UAAK;2BAQLA,UAAK;mCAWLA,UAAK;;QA2GR,qBAAC;KAjKD,IAiKC;;;QA5IC,+BAAc;;QACd,+BAAc;;QACd,6BAAS;;QACT,8BAAa;;QACb,mCAAyB;;QACzB,+BAA6D;;QAC7D,gCAA8D;;;;;QA2B9D,sCAAoC;;QAxBlC,oCAA+B;;QAC/B,6BAAsB;;QACtB,oCAA8C;;;;;;IAmIlD,SAAS,UAAU,CAAC,IAAY;;;YAExB,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC;QAC9C,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC;QACrB,OAAO,GAAG,CAAC,KAAK,CAAC;KAClB;;;;;;;ACxLD;QAEA;SAGC;;oBAHAX,eAAU;;QAGX,kBAAC;KAHD;;;;;;;ACFA;QAMA;SAaC;;;;QANe,mBAAO;;;QAArB;YACE,OAAO;gBACL,QAAQ,EAAE,WAAW;gBACrB,SAAS,EAAE,CAAC,WAAW,CAAC;aACzB,CAAC;SACH;;oBAZFY,aAAQ,SAAC;wBACR,OAAO,EAAE,CAACC,mBAAY,CAAC;wBACvB,YAAY,EAAE,CAAC,cAAc,CAAC;wBAC9B,SAAS,EAAE,CAAC,YAAY,CAAC;wBACzB,OAAO,EAAE,CAAC,cAAc,CAAC;qBAC1B;;QAQD,kBAAC;KAbD;;;;;;;;;;;;;;;"}