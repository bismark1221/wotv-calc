!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("rxjs/add/operator/takeUntil"),require("@angular/forms"),require("rxjs/Subject"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/add/operator/takeUntil","@angular/forms","rxjs/Subject","@angular/common"],factory):factory(global.dropdown=global.dropdown||{},global.ng.core,global.Rx.Observable.prototype,global.ng.forms,global.Rx,global.ng.common)}(this,function(exports,_angular_core,rxjs_add_operator_takeUntil,_angular_forms,rxjs_Subject,_angular_common){"use strict";var MultiSelectSearchFilter=function(){function MultiSelectSearchFilter(){this._searchCache={},this._searchCacheInclusive={}}return MultiSelectSearchFilter.prototype.transform=function(options,str,limit,renderLimit){void 0===limit&&(limit=0),void 0===renderLimit&&(renderLimit=0),str=(str||"").toLowerCase(),options!==this._lastOptions&&(this._lastOptions=options,this._searchCache={},this._searchCacheInclusive={});var isUnderLimit=options.length<=limit;if(this._searchCache[str])return isUnderLimit?this._searchCache[str]:this._limitRenderedItems(this._searchCache[str],renderLimit);var prevStr=str.slice(0,-1),prevResults=this._searchCache[prevStr];if(prevResults){var prevInclusiveOrIdx=this._searchCacheInclusive[prevStr];prevInclusiveOrIdx===!0?options=prevResults:"number"==typeof prevInclusiveOrIdx&&(options=prevResults.concat(options.slice(prevInclusiveOrIdx)))}for(var optsLength=options.length,maxFound=limit>0?Math.min(limit,optsLength):optsLength,filteredOpts=[],regexp=new RegExp(this._escapeRegExp(str),"i"),matchPredicate=function(option){return regexp.test(option.name)},getChildren=function(option){return options.filter(function(child){return child.parentId===option.id})},getParent=function(option){return options.find(function(parent){return option.parentId===parent.id})},i=0,founded=0;optsLength>i&&maxFound>founded;++i){var option=options[i],directMatch=regexp.test(option.name);if(directMatch)filteredOpts.push(option),founded++;else{if("undefined"==typeof option.parentId){var childrenMatch=getChildren(option).some(matchPredicate);if(childrenMatch){filteredOpts.push(option),founded++;continue}}if("undefined"!=typeof option.parentId){var parentMatch=matchPredicate(getParent(option));if(parentMatch){filteredOpts.push(option),founded++;continue}}}}return this._searchCache[str]=filteredOpts,this._searchCacheInclusive[str]=i===optsLength||i+1,isUnderLimit?filteredOpts:this._limitRenderedItems(filteredOpts,renderLimit)},MultiSelectSearchFilter.prototype._limitRenderedItems=function(items,limit){return items.length>limit&&limit>0?items.slice(0,limit):items},MultiSelectSearchFilter.prototype._escapeRegExp=function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},MultiSelectSearchFilter}();MultiSelectSearchFilter.decorators=[{type:_angular_core.Pipe,args:[{name:"searchFilter"}]}],MultiSelectSearchFilter.ctorParameters=function(){return[]};var MULTISELECT_VALUE_ACCESSOR={provide:_angular_forms.NG_VALUE_ACCESSOR,useExisting:_angular_core.forwardRef(function(){return MultiselectDropdown}),multi:!0},MultiselectDropdown=function(){function MultiselectDropdown(element,fb,searchFilter,differs){this.element=element,this.fb=fb,this.searchFilter=searchFilter,this.filterControl=this.fb.control(""),this.disabled=!1,this.selectionLimitReached=new _angular_core.EventEmitter,this.dropdownClosed=new _angular_core.EventEmitter,this.dropdownOpened=new _angular_core.EventEmitter,this.onAdded=new _angular_core.EventEmitter,this.onRemoved=new _angular_core.EventEmitter,this.onLazyLoad=new _angular_core.EventEmitter,this.onFilter=this.filterControl.valueChanges,this.destroyed$=new rxjs_Subject.Subject,this.filteredOptions=[],this.renderFilteredOptions=[],this.model=[],this.numSelected=0,this.renderItems=!0,this.defaultSettings={closeOnClickOutside:!0,pullRight:!1,enableSearch:!1,searchRenderLimit:0,searchRenderAfter:1,searchMaxLimit:0,searchMaxRenderedItems:0,checkedStyle:"checkboxes",buttonClasses:"btn btn-default btn-secondary",containerClasses:"dropdown-inline",selectionLimit:0,minSelectionLimit:0,closeOnSelect:!1,autoUnselect:!1,showCheckAll:!1,showUncheckAll:!1,fixedTitle:!1,dynamicTitleMaxItems:3,maxHeight:"300px",isLazyLoad:!1,stopScrollPropagation:!1,loadViewDistance:1},this.defaultTexts={checkAll:"Check all",uncheckAll:"Uncheck all",checked:"checked",checkedPlural:"checked",searchPlaceholder:"Search...",searchEmptyResult:"Nothing found...",searchNoRenderText:"Type in search box to see results...",defaultTitle:"Select",allSelected:"All selected"},this._isVisible=!1,this._workerDocClicked=!1,this.onModelChange=function(){},this.onModelTouched=function(){},this.differ=differs.find([]).create(null),this.settings=this.defaultSettings,this.texts=this.defaultTexts}return MultiselectDropdown.prototype.onClick=function(target){if(this.isVisible&&this.settings.closeOnClickOutside){for(var parentFound=!1;null!=target&&!parentFound;)target===this.element.nativeElement&&(parentFound=!0),target=target.parentElement;parentFound||(this.isVisible=!1,this.dropdownClosed.emit())}},Object.defineProperty(MultiselectDropdown.prototype,"isVisible",{get:function(){return this._isVisible},set:function(val){this._isVisible=val,this._workerDocClicked=val?!1:this._workerDocClicked},enumerable:!0,configurable:!0}),Object.defineProperty(MultiselectDropdown.prototype,"searchLimit",{get:function(){return this.settings.searchRenderLimit},enumerable:!0,configurable:!0}),Object.defineProperty(MultiselectDropdown.prototype,"searchRenderAfter",{get:function(){return this.settings.searchRenderAfter},enumerable:!0,configurable:!0}),Object.defineProperty(MultiselectDropdown.prototype,"searchLimitApplied",{get:function(){return this.searchLimit>0&&this.options.length>this.searchLimit},enumerable:!0,configurable:!0}),MultiselectDropdown.prototype.getItemStyle=function(option){return option.isLabel?void 0:{cursor:"pointer"}},MultiselectDropdown.prototype.getItemStyleSelectionDisabled=function(){return this.disabledSelection?{cursor:"default"}:void 0},MultiselectDropdown.prototype.ngOnInit=function(){this.settings=Object.assign(this.defaultSettings,this.settings),this.texts=Object.assign(this.defaultTexts,this.texts),this.title=this.texts.defaultTitle||"",this.filterControl.valueChanges.takeUntil(this.destroyed$).subscribe(function(){this.updateRenderItems(),this.settings.isLazyLoad&&this.load()}.bind(this))},MultiselectDropdown.prototype.ngOnChanges=function(changes){changes.options&&(this.options=this.options||[],this.parents=this.options.filter(function(option){return"number"==typeof option.parentId}).map(function(option){return option.parentId}),this.updateRenderItems(),this.texts&&this.updateTitle()),changes.texts&&!changes.texts.isFirstChange()&&this.updateTitle()},MultiselectDropdown.prototype.ngOnDestroy=function(){this.destroyed$.next()},MultiselectDropdown.prototype.updateRenderItems=function(){this.renderItems=!this.searchLimitApplied||this.filterControl.value.length>=this.searchRenderAfter,this.filteredOptions=this.searchFilter.transform(this.options,this.settings.isLazyLoad?"":this.filterControl.value,this.settings.searchMaxLimit,this.settings.searchMaxRenderedItems),this.renderFilteredOptions=this.renderItems?this.filteredOptions:[]},MultiselectDropdown.prototype.writeValue=function(value){this.model=void 0!==value&&null!==value?Array.isArray(value)?value:[value]:[]},MultiselectDropdown.prototype.registerOnChange=function(fn){this.onModelChange=fn},MultiselectDropdown.prototype.registerOnTouched=function(fn){this.onModelTouched=fn},MultiselectDropdown.prototype.setDisabledState=function(isDisabled){this.disabled=isDisabled},MultiselectDropdown.prototype.ngDoCheck=function(){var changes=this.differ.diff(this.model);changes&&(this.updateNumSelected(),this.updateTitle())},MultiselectDropdown.prototype.validate=function(){return this.model&&this.model.length?null:{required:{valid:!1}}},MultiselectDropdown.prototype.registerOnValidatorChange=function(){throw new Error("Method not implemented.")},MultiselectDropdown.prototype.clearSearch=function(event){event.stopPropagation&&event.stopPropagation(),this.filterControl.setValue("")},MultiselectDropdown.prototype.toggleDropdown=function(){this.isVisible=!this.isVisible,this.isVisible?this.dropdownOpened.emit():this.dropdownClosed.emit()},MultiselectDropdown.prototype.isSelected=function(option){return this.model&&this.model.indexOf(option.id)>-1},MultiselectDropdown.prototype.setSelected=function(_event,option){var _this=this;if(!option.isLabel&&!this.disabledSelection){_event.stopPropagation&&_event.stopPropagation();var index=this.model.indexOf(option.id);if(index>-1){(void 0===this.settings.minSelectionLimit||this.numSelected>this.settings.minSelectionLimit)&&(this.model.splice(index,1),this.onRemoved.emit(option.id));var parentIndex=option.parentId&&this.model.indexOf(option.parentId);if(parentIndex>=0)this.model.splice(parentIndex,1),this.onRemoved.emit(option.parentId);else if(this.parents.indexOf(option.id)>-1){var childIds_1=this.options.filter(function(child){return _this.model.indexOf(child.id)>-1&&child.parentId==option.id}).map(function(child){return child.id});this.model=this.model.filter(function(id){return childIds_1.indexOf(id)<0}),childIds_1.forEach(function(childId){return _this.onRemoved.emit(childId)})}}else if(0===this.settings.selectionLimit||this.settings.selectionLimit&&this.model.length<this.settings.selectionLimit){if(this.model.push(option.id),this.onAdded.emit(option.id),option.parentId){var children=this.options.filter(function(child){return child.id!==option.id&&child.parentId==option.parentId});children.every(function(child){return _this.model.indexOf(child.id)>-1})&&(this.model.push(option.parentId),this.onAdded.emit(option.parentId))}else if(this.parents.indexOf(option.id)>-1){var children=this.options.filter(function(child){return _this.model.indexOf(child.id)<0&&child.parentId==option.id});children.forEach(function(child){_this.model.push(child.id),_this.onAdded.emit(child.id)})}}else{if(!this.settings.autoUnselect)return void this.selectionLimitReached.emit(this.model.length);this.model.push(option.id),this.onAdded.emit(option.id);var removedOption=this.model.shift();this.onRemoved.emit(removedOption)}this.settings.closeOnSelect&&this.toggleDropdown(),this.model=this.model.slice(),this.onModelChange(this.model),this.onModelTouched()}},MultiselectDropdown.prototype.updateNumSelected=function(){var _this=this;this.numSelected=this.model.filter(function(id){return _this.parents.indexOf(id)<0}).length||0},MultiselectDropdown.prototype.updateTitle=function(){var _this=this;this.title=0===this.numSelected||this.settings.fixedTitle?this.texts?this.texts.defaultTitle:"":this.settings.displayAllSelectedText&&this.model.length===this.options.length?this.texts?this.texts.allSelected:"":this.settings.dynamicTitleMaxItems&&this.settings.dynamicTitleMaxItems>=this.numSelected?this.options.filter(function(option){return _this.model.indexOf(option.id)>-1}).map(function(option){return option.name}).join(", "):this.numSelected+" "+(1===this.numSelected?this.texts.checked:this.texts.checkedPlural)},MultiselectDropdown.prototype.searchFilterApplied=function(){return this.settings.enableSearch&&this.filterControl.value&&this.filterControl.value.length>0},MultiselectDropdown.prototype.checkAll=function(){var _this=this;if(!this.disabledSelection){var checkedOptions=(this.searchFilterApplied()?this.filteredOptions:this.options).filter(function(option){return-1===_this.model.indexOf(option.id)?(_this.onAdded.emit(option.id),!0):!1}).map(function(option){return option.id});this.model=this.model.concat(checkedOptions),this.onModelChange(this.model),this.onModelTouched()}},MultiselectDropdown.prototype.uncheckAll=function(){var _this=this;if(!this.disabledSelection){var unCheckedOptions_1=this.searchFilterApplied()?this.filteredOptions.map(function(option){return option.id}):this.model;this.model=this.model.filter(function(id){return unCheckedOptions_1.indexOf(id)<0&&void 0===_this.settings.minSelectionLimit||unCheckedOptions_1.indexOf(id)<_this.settings.minSelectionLimit?!0:(_this.onRemoved.emit(id),!1)}),this.onModelChange(this.model),this.onModelTouched()}},MultiselectDropdown.prototype.preventCheckboxCheck=function(event,option){this.settings.selectionLimit&&!this.settings.autoUnselect&&this.model.length>=this.settings.selectionLimit&&-1===this.model.indexOf(option.id)&&event.preventDefault&&event.preventDefault()},MultiselectDropdown.prototype.isCheckboxDisabled=function(){return this.disabledSelection},MultiselectDropdown.prototype.checkScrollPosition=function(ev){var scrollTop=ev.target.scrollTop,scrollHeight=ev.target.scrollHeight,scrollElementHeight=ev.target.clientHeight,roundingPixel=1,gutterPixel=1;scrollTop>=scrollHeight-(1+this.settings.loadViewDistance)*scrollElementHeight-roundingPixel-gutterPixel&&this.load()},MultiselectDropdown.prototype.checkScrollPropagation=function(ev,element){var scrollTop=element.scrollTop,scrollHeight=element.scrollHeight,scrollElementHeight=element.clientHeight;(ev.deltaY>0&&scrollTop+scrollElementHeight>=scrollHeight||ev.deltaY<0&&0>=scrollTop)&&(ev=ev||window.event,ev.preventDefault&&ev.preventDefault(),ev.returnValue=!1)},MultiselectDropdown.prototype.load=function(){this.onLazyLoad.emit({length:this.options.length,filter:this.filterControl.value})},MultiselectDropdown}();MultiselectDropdown.decorators=[{type:_angular_core.Component,args:[{selector:"ss-multiselect-dropdown",template:'<div class="dropdown" [ngClass]="settings.containerClasses" [class.open]="isVisible"><button type="button" class="dropdown-toggle" [ngClass]="settings.buttonClasses" (click)="toggleDropdown()" [disabled]="disabled">{{ title }}<span class="caret"></span></button><ul #scroller *ngIf="isVisible" class="dropdown-menu" (scroll)="settings.isLazyLoad ? checkScrollPosition($event) : null" (wheel)="settings.stopScrollPropagation ? checkScrollPropagation($event, scroller) : null" [class.pull-right]="settings.pullRight" [class.dropdown-menu-right]="settings.pullRight" [style.max-height]="settings.maxHeight" style="display: block; height: auto; overflow-y: auto"><li class="dropdown-item search" *ngIf="settings.enableSearch"><div class="input-group input-group-sm"><span class="input-group-addon" id="sizing-addon3"><i class="fa fa-search"></i></span> <input type="text" class="form-control" placeholder="{{ texts.searchPlaceholder }}" aria-describedby="sizing-addon3" [formControl]="filterControl" autofocus> <span class="input-group-btn" *ngIf="filterControl.value.length > 0"><button class="btn btn-default btn-secondary" type="button" (click)="clearSearch($event)"><i class="fa fa-times"></i></button></span></div></li><li class="dropdown-divider divider" *ngIf="settings.enableSearch"></li><li class="dropdown-item check-control check-control-check" *ngIf="settings.showCheckAll && !disabledSelection"><a href="javascript:;" role="menuitem" tabindex="-1" (click)="checkAll()"><span style="width: 16px" [ngClass]="{\'glyphicon glyphicon-ok\': settings.checkedStyle !== \'fontawesome\',\'fa fa-check\': settings.checkedStyle === \'fontawesome\'}"></span> {{ texts.checkAll }}</a></li><li class="dropdown-item check-control check-control-uncheck" *ngIf="settings.showUncheckAll && !disabledSelection"><a href="javascript:;" role="menuitem" tabindex="-1" (click)="uncheckAll()"><span style="width: 16px" [ngClass]="{\'glyphicon glyphicon-remove\': settings.checkedStyle !== \'fontawesome\',\'fa fa-times\': settings.checkedStyle === \'fontawesome\'}"></span> {{ texts.uncheckAll }}</a></li><li *ngIf="settings.showCheckAll || settings.showUncheckAll" class="dropdown-divider divider"></li><li *ngIf="!renderItems" class="dropdown-item empty">{{ texts.searchNoRenderText }}</li><li *ngIf="renderItems && !renderFilteredOptions.length" class="dropdown-item empty">{{ texts.searchEmptyResult }}</li><li class="dropdown-item" *ngFor="let option of renderFilteredOptions" (click)="setSelected($event, option)" [ngStyle]="getItemStyle(option)" [ngClass]="option.classes" [class.dropdown-header]="option.isLabel"><a *ngIf="!option.isLabel; else label" href="javascript:;" role="menuitem" tabindex="-1" [style.padding-left]="this.parents.length>0&&this.parents.indexOf(option.id)<0&&\'30px\'" [ngStyle]="getItemStyleSelectionDisabled()"><ng-container [ngSwitch]="settings.checkedStyle"><input *ngSwitchCase="\'checkboxes\'" type="checkbox" [checked]="isSelected(option)" (click)="preventCheckboxCheck($event, option)" [disabled]="isCheckboxDisabled()" [ngStyle]="getItemStyleSelectionDisabled()" > <span *ngSwitchCase="\'glyphicon\'" style="width: 16px" class="glyphicon" [class.glyphicon-ok]="isSelected(option)"></span> <span *ngSwitchCase="\'fontawesome\'" style="width: 16px;display: inline-block"><i *ngIf="isSelected(option)" class="fa fa-check" aria-hidden="true"></i></span></ng-container><span [ngClass]="settings.itemClasses" [style.font-weight]="this.parents.indexOf(option.id)>=0?\'bold\':\'normal\'">{{ option.name }}</span></a><ng-template #label>{{ option.name }}</ng-template></li></ul></div>',styles:["a {  outline: none !important;}.dropdown-inline {  display: inline-block;}.dropdown-toggle .caret {  margin-left: 4px;  white-space: nowrap;  display: inline-block;}"],providers:[MULTISELECT_VALUE_ACCESSOR,MultiSelectSearchFilter]}]}],MultiselectDropdown.ctorParameters=function(){return[{type:_angular_core.ElementRef},{type:_angular_forms.FormBuilder},{type:MultiSelectSearchFilter},{type:_angular_core.IterableDiffers}]},MultiselectDropdown.propDecorators={options:[{type:_angular_core.Input}],settings:[{type:_angular_core.Input}],texts:[{type:_angular_core.Input}],disabled:[{type:_angular_core.Input}],disabledSelection:[{type:_angular_core.Input}],selectionLimitReached:[{type:_angular_core.Output}],dropdownClosed:[{type:_angular_core.Output}],dropdownOpened:[{type:_angular_core.Output}],onAdded:[{type:_angular_core.Output}],onRemoved:[{type:_angular_core.Output}],onLazyLoad:[{type:_angular_core.Output}],onFilter:[{type:_angular_core.Output}],onClick:[{type:_angular_core.HostListener,args:["document: click",["$event.target"]]}]};var MultiselectDropdownModule=function(){function MultiselectDropdownModule(){}return MultiselectDropdownModule}();MultiselectDropdownModule.decorators=[{type:_angular_core.NgModule,args:[{imports:[_angular_common.CommonModule,_angular_forms.ReactiveFormsModule],exports:[MultiselectDropdown,MultiSelectSearchFilter],declarations:[MultiselectDropdown,MultiSelectSearchFilter]}]}],MultiselectDropdownModule.ctorParameters=function(){return[]},exports.MultiSelectSearchFilter=MultiSelectSearchFilter,exports.MultiselectDropdownModule=MultiselectDropdownModule,exports.MultiselectDropdown=MultiselectDropdown,Object.defineProperty(exports,"__esModule",{value:!0})});